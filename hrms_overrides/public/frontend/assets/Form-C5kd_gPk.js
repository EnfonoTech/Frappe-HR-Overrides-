import{I as C,a as V}from"./index-2Eufh0cZ.js";import{r as k,i as A,c as S,N as u,w,z as i,l as d,q as l,j as p,k as b,a3 as E}from"./frappe-ui-CgmWUd__.js";import I from"./FormView-wlFQr2-U.js";import{g as N}from"./workflow-C9SRSeAo.js";import"./FormField-VjUN8qpQ.js";import"./Link-CsM06SXZ.js";import"./FileUploaderView-BmT9BQ7_.js";import"./formatters-DOj-qu5a.js";const D={__name:"Form",props:{id:{type:String,required:!1}},setup(y){const t=A("$employee"),s=y,n=k({employee:t.data.name,employee_name:t.data.employee_name,company:t.data.company,department:t.data.department,repay_unclaimed_amount_from_salary:1}),c=S(()=>N(n.value.company)),o=u({url:"hrms.api.get_doctype_fields",params:{doctype:"Employee Advance"},transform(e){const a=g(e);return h(a)},onSuccess(e){_.reload(),v.reload()}});o.reload();const _=u({url:"hrms.payroll.doctype.salary_structure_assignment.salary_structure_assignment.get_employee_currency",params:{employee:t.data.name},onSuccess(e){n.value.currency=e,m()}}),f=u({url:"erpnext.setup.utils.get_exchange_rate",onSuccess(e){n.value.exchange_rate=e}}),v=u({url:"hrms.api.get_advance_account",params:{company:n.value.company},onSuccess(e){n.value.advance_account=e}});w(()=>n.value.currency,()=>m());function g(e){const a=["naming_series","currency_section","section_break_7"],r=["employee","employee_name","department","company","more_info_section","pending_amount"];return s.id||a.push(...r),e.filter(F=>!a.includes(F.fieldname))}function h(e){return e.map(a=>{if(["currency","exchange_rate","advance_account","mode_of_payment","repay_unclaimed_amount_from_salary"].includes(a.fieldname)&&(a.hidden=!0),a.fieldname==="advance_account"){let r=[n.value.currency];n.value.currency!=c.value&&r.push(c.value),a.linkFilters={company:n.value.company,is_group:0,root_type:"Asset",account_currency:r}}return a})}function m(){var a;if(!n.value.currency)return;const e=(a=o.data)==null?void 0:a.find(r=>r.fieldname==="exchange_rate");n.value.currency===c.value?(n.value.exchange_rate=1,e.hidden=1):(f.fetch({from_currency:n.value.currency,to_currency:c.value}),e.hidden=0)}function x(){}return(e,a)=>(p(),i(l(C),null,{default:d(()=>[b(l(V),{fullscreen:!0},{default:d(()=>[l(o).data?(p(),i(I,{key:0,doctype:"Employee Advance",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=r=>n.value=r),isSubmittable:!0,fields:l(o).data,id:s.id,showAttachmentView:!0,onValidateForm:x},null,8,["modelValue","fields","id"])):E("",!0)]),_:1})]),_:1}))}};export{D as default};
//# sourceMappingURL=Form-C5kd_gPk.js.map
