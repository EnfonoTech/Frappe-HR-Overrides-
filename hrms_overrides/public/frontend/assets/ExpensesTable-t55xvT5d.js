var L=Object.defineProperty;var I=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var V=(t,i,n)=>i in t?L(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n,q=(t,i)=>{for(var n in i||(i={}))G.call(i,n)&&V(t,n,i[n]);if(I)for(var n of I(i))J.call(i,n)&&V(t,n,i[n]);return t};var F=(t,i,n)=>new Promise((y,w)=>{var r=u=>{try{d(n.next(u))}catch(x){w(x)}},o=u=>{try{d(n.throw(u))}catch(x){w(x)}},d=u=>u.done?y(u.value):Promise.resolve(u.value).then(r,o);d((n=n.apply(t,i)).next())});import{i as N,r as g,N as K,c as R,w as T,e as P,f as v,j as m,x as a,z as k,k as _,t as f,q as l,a3 as C,F as O,H as M,v as $,l as b,n as S}from"./frappe-ui-cwn_FB2J.js";import Q from"./FormField-BcUsybCw.js";import{_ as W}from"./index-E0LhrS2r.js";import X from"./CustomIonModal-_5y5_wOk.js";import{c as Y}from"./claims-DTB9hIrp.js";import{f as B}from"./formatters-BqzjcjRp.js";import"./Link-dzoZTX1a.js";const Z={class:"flex flex-row justify-between items-center mt-2"},ee={class:"text-base font-semibold text-gray-800"},te={class:"flex flex-row gap-3 items-center"},se={class:"text-base font-semibold text-gray-800"},ae={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},ne=["onClick"],le={class:"flex flex-col w-full justify-center gap-2.5"},oe={class:"flex flex-row items-center justify-between"},ie={class:"flex flex-row items-start gap-3 grow"},re={class:"flex flex-col items-start gap-1.5"},de={class:"text-base font-normal text-gray-800"},ce={class:"text-xs font-normal text-gray-500"},ue={key:0,class:"whitespace-nowrap"},me={class:"flex flex-row justify-end items-center gap-2"},pe={class:"text-gray-700 font-normal rounded text-base"},fe={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},xe={class:"w-full pt-8 pb-5 border-b text-center"},ve={class:"text-gray-900 font-bold text-lg"},ye={class:"w-full flex flex-col items-center justify-center gap-5 p-4 max-h-[80vh]"},_e={class:"flex flex-col w-full space-y-4 overflow-y-auto"},be={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Be={__name:"ExpensesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-item","update-expense-item","delete-expense-item"],setup(t,{emit:i}){const n=t,y=i,w=N("$dayjs"),r=N("$translate"),o=g({}),d=g(null),u=g(!1),x=g(!1),D=(c,s)=>F(this,null,function*(){c&&(o.value=q({},c),d.value=s),x.value=!0,u.value=!0}),U=()=>{y("delete-expense-item",d.value),j()},z=()=>{d.value===null?y("add-expense-item",o.value):y("update-expense-item",o.value,d.value),j()};function j(){x.value=!1,u.value=!1,o.value={},d.value=null}const E=K({url:"hrms.api.get_doctype_fields",params:{doctype:"Expense Claim Detail"},transform(c){const s=["description_sb","amounts_sb","accounting_dimensions_section"];return c.filter(p=>!s.includes(p.fieldname)).map(p=>(["cost_center","project"].includes(p.fieldname)&&(p.hidden=!0),p))}});E.reload();const A=R(()=>n.isReadOnly?r("Expense Item"):d.value===null?r("New Expense Item"):r("Edit Expense Item")),H=R(()=>{var c;return(c=E.data)==null?void 0:c.some(s=>{if(s.reqd&&!o.value[s.fieldname])return!0})});return T(()=>o.value.expense_type,c=>{var s;o.value.description||(o.value.description=(s=Y[c])==null?void 0:s.description),o.value.cost_center=n.expenseClaim.cost_center}),T(()=>o.value.amount,c=>{x.value?x.value=!1:o.value.sanctioned_amount=parseFloat(c)}),(c,s)=>{const p=P("Button");return m(),v(O,null,[a("div",Z,[a("h2",ee,f(l(r)("Expenses")),1),a("div",te,[a("span",se,f(l(B)(t.expenseClaim.total_claimed_amount,t.currency)),1),t.isReadOnly?C("",!0):(m(),k(p,{key:0,id:"add-expense-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:s[0]||(s[0]=e=>D())}))])]),t.expenseClaim.expenses?(m(),v("div",ae,[(m(!0),v(O,null,M(t.expenseClaim.expenses,(e,h)=>(m(),v("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:h,onClick:we=>D(e,h)},[a("div",le,[a("div",oe,[a("div",ie,[a("div",re,[a("div",de,f(l(r)(e.expense_type)),1),a("div",ce,[a("span",null,f(l(r)("{0}: {1}",[l(r)("Sanctioned"),l(B)(e.sanctioned_amount||0,t.currency)])),1),s[4]||(s[4]=a("span",{class:"whitespace-pre"}," Â· ",-1)),e.expense_date?(m(),v("span",ue,f(l(w)(e.expense_date).format("D MMM")),1)):C("",!0)])])]),a("div",me,[a("span",pe,f(l(B)(e.amount,t.currency)),1),_(l($),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,ne))),128))])):(m(),k(W,{key:1,message:l(r)("No expenses added"),isTableField:!0},null,8,["message"])),_(X,{isOpen:u.value,onDidDismiss:s[3]||(s[3]=e=>j())},{actionSheet:b(()=>[a("div",fe,[a("div",xe,[a("span",ve,f(A.value),1)]),a("div",ye,[a("div",_e,[(m(!0),v(O,null,M(l(E).data,e=>(m(),k(Q,{key:e.fieldname,class:"w-full",label:l(r)(e.label,null,"Expense Claim Detail"),fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,hidden:e.hidden,reqd:e.reqd,default:e.default,readOnly:e.read_only||t.isReadOnly,modelValue:o.value[e.fieldname],"onUpdate:modelValue":h=>o.value[e.fieldname]=h},null,8,["label","fieldtype","fieldname","options","hidden","reqd","default","readOnly","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?C("",!0):(m(),v("div",be,[d.value!==null?(m(),k(p,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:s[1]||(s[1]=e=>U())},{prefix:b(()=>[_(l($),{name:"trash",class:"w-4"})]),default:b(()=>[S(" "+f(l(r)("Delete")),1)]),_:1})):C("",!0),_(p,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:s[2]||(s[2]=e=>z()),disabled:H.value},{prefix:b(()=>[_(l($),{name:d.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[S(" "+f(d.value===null?l(r)("Add Expense"):l(r)("Update Expense")),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)}}};export{Be as default};
//# sourceMappingURL=ExpensesTable-t55xvT5d.js.map
