import{I as T,a as Y}from"./index-B6FRLPIi.js";import{i as p,r as C,N as d,w as s,z as b,l as F,q as i,j as L,k as I,a3 as N}from"./frappe-ui-CgmWUd__.js";import R from"./FormView-BQIrwm-y.js";import"./FormField-VjUN8qpQ.js";import"./Link-CsM06SXZ.js";import"./FileUploaderView-Y7HT3JPL.js";import"./workflow-BjdAssIw.js";import"./formatters-C1Z8-ffl.js";const J={__name:"Form",props:{id:{type:String,required:!1}},setup(S){const V=p("$dayjs"),r=p("$employee"),w=p("$translate"),v=V().format("YYYY-MM-DD"),u=S,a=C({}),n=d({url:"hrms.api.get_doctype_fields",params:{doctype:"Leave Application"},transform(e){return $(e).map(l=>(l.fieldname==="half_day_date"&&(l.hidden=!0),l.fieldname==="posting_date"&&(l.default=v),l))},onSuccess(e){A.reload(),f.reload()}});n.reload();const A=d({url:"hrms.api.get_leave_approval_details",params:{employee:r.data.name},onSuccess(e){j(e)}}),f=d({url:"hrms.api.get_leave_types",params:{employee:r.data.name,date:v},onSuccess(e){k(e)}});s(()=>a.value.employee,e=>{u.id&&e!==r.data.name&&x()}),s(()=>a.value.leave_type,e=>y()),s(()=>a.value.half_day,e=>h(e)),s(()=>a.value.half_day&&a.value.half_day_date,()=>c()),s(()=>a.value.from_date,e=>{a.value.to_date||(a.value.to_date=e),f.fetch({employee:r.data.name,date:e})}),s(()=>[a.value.from_date,a.value.to_date],([e,t])=>{B(e,t),D(),c()}),s(()=>a.value.leave_approver,e=>{var o,_;const t=n.data.find(m=>m.fieldname==="leave_approver"),l=(o=t==null?void 0:t.documentList)==null?void 0:o.find(m=>m.value===e);a.value.leave_approver_name=((_=l==null?void 0:l.label)==null?void 0:_.split(" : ")[1])||""});function $(e){const t=["naming_series","sb_other_details","salary_slip","letter_head"],l=["employee","employee_name","department","company","follow_via_email","status","posting_date"];return u.id||t.push(...l),e.filter(o=>!t.includes(o.fieldname))}function x(){a.value.leave_approver!==r.data.user_id&&n.data.map(e=>e.read_only=!0)}function B(e,t){if(!(e&&t))return;const l=e>t?w("To Date cannot be before From Date"):"",o=n.data.find(_=>_.fieldname==="from_date");o.error_message=l}function c(){if(!g())return;d({url:"hrms.hr.doctype.leave_application.leave_application.get_number_of_leave_days",params:{employee:r.data.name,leave_type:a.value.leave_type,from_date:a.value.from_date,to_date:a.value.to_date,half_day:a.value.half_day,half_day_date:a.value.half_day_date},onSuccess(t){a.value.total_leave_days=t}}).reload(),y()}function y(){if(!g())return;d({url:"hrms.hr.doctype.leave_application.leave_application.get_leave_balance_on",params:{employee:r.data.name,date:a.value.from_date,to_date:a.value.to_date,leave_type:a.value.leave_type,consider_all_leaves_in_the_allocation_period:1},onSuccess(t){a.value.leave_balance=t}}).reload()}function h(e){const t=n.data.find(l=>l.fieldname==="half_day_date");t.hidden=!e,t.reqd=e,e&&(a.value.from_date===a.value.to_date?a.value.half_day_date=a.value.from_date:D())}function D(){const e=n.data.find(t=>t.fieldname==="half_day_date");e.minDate=a.value.from_date,e.maxDate=a.value.to_date}function j(e){var l;const t=(l=n.data)==null?void 0:l.find(o=>o.fieldname==="leave_approver");t.reqd=e==null?void 0:e.is_mandatory,t.documentList=e==null?void 0:e.department_approvers.map(o=>({label:o.full_name?`${o.name} : ${o.full_name}`:o.name,value:o.name})),a.value.leave_approver=e==null?void 0:e.leave_approver,a.value.leave_approver_name=e==null?void 0:e.leave_approver_name}function k(e){const t=n.data.find(l=>l.fieldname==="leave_type");t.documentList=e==null?void 0:e.map(l=>({label:l,value:l}))}function g(){return a.value.from_date&&a.value.to_date&&a.value.leave_type}function q(){h(a.value.half_day),a.value.employee=r.data.name}return(e,t)=>(L(),b(i(T),null,{default:F(()=>[I(i(Y),{fullscreen:!0},{default:F(()=>[i(n).data?(L(),b(R,{key:0,doctype:"Leave Application",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),isSubmittable:!0,fields:i(n).data,id:u.id,showAttachmentView:!0,onValidateForm:q},null,8,["modelValue","fields","id"])):N("",!0)]),_:1})]),_:1}))}};export{J as default};
//# sourceMappingURL=Form-JeUvagGm.js.map
