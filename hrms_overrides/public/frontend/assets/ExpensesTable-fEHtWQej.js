var L=Object.defineProperty;var F=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var I=(a,u,l)=>u in a?L(a,u,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[u]=l,V=(a,u)=>{for(var l in u||(u={}))G.call(u,l)&&I(a,l,u[l]);if(F)for(var l of F(u))J.call(u,l)&&I(a,l,u[l]);return a};var q=(a,u,l)=>new Promise((v,h)=>{var r=m=>{try{d(l.next(m))}catch(x){h(x)}},e=m=>{try{d(l.throw(m))}catch(x){h(x)}},d=m=>m.done?v(m.value):Promise.resolve(m.value).then(r,e);d((l=l.apply(a,u)).next())});import{i as R,r as k,N as K,w as C,c as T,e as P,f as _,j as p,x as n,z as j,k as y,t as f,q as o,a3 as E,F as $,H as M,v as N,l as b,n as S}from"./frappe-ui-CgmWUd__.js";import Q from"./FormField-VjUN8qpQ.js";import{_ as W}from"./index-2Eufh0cZ.js";import X from"./CustomIonModal-BUNJ-L1S.js";import{c as Y}from"./claims-BPi7fgsd.js";import{f as B}from"./formatters-DOj-qu5a.js";import"./Link-CsM06SXZ.js";const Z={class:"flex flex-row justify-between items-center mt-2"},ee={class:"text-base font-semibold text-gray-800"},te={class:"flex flex-row gap-3 items-center"},se={class:"text-base font-semibold text-gray-800"},ae={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},ne=["onClick"],le={class:"flex flex-col w-full justify-center gap-2.5"},oe={class:"flex flex-row items-center justify-between"},ie={class:"flex flex-row items-start gap-3 grow"},ue={class:"flex flex-col items-start gap-1.5"},re={class:"text-base font-normal text-gray-800"},ce={class:"text-xs font-normal text-gray-500"},de={key:0,class:"whitespace-nowrap"},me={class:"flex flex-row justify-end items-center gap-2"},pe={class:"text-gray-700 font-normal rounded text-base"},fe={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},xe={class:"w-full pt-8 pb-5 border-b text-center"},_e={class:"text-gray-900 font-bold text-lg"},ve={class:"w-full flex flex-col items-center justify-center gap-5 p-4 max-h-[80vh]"},ye={class:"flex flex-col w-full space-y-4 overflow-y-auto"},be={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Ne={__name:"ExpensesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-item","update-expense-item","delete-expense-item"],setup(a,{emit:u}){const l=a,v=u,h=R("$dayjs"),r=R("$translate"),e=k({}),d=k(null),m=k(!1),x=k(!1),D=(c,t)=>q(this,null,function*(){c&&(e.value=V({},c),d.value=t),x.value=!0,m.value=!0}),U=()=>{v("delete-expense-item",d.value),O()},z=()=>{d.value===null?v("add-expense-item",e.value):v("update-expense-item",e.value,d.value),O()};function O(){x.value=!1,m.value=!1,e.value={},d.value=null}const w=K({url:"hrms.api.get_doctype_fields",params:{doctype:"Expense Claim Detail"},transform(c){const t=["description_sb","amounts_sb","accounting_dimensions_section"];return c.filter(i=>!t.includes(i.fieldname)).map(i=>(["cost_center","project","custom_purchase_invoice","custom_tax_account","custom_vat"].includes(i.fieldname)&&(i.hidden=!0),["custom_purchase_bill_number","custom_invoice_number"].includes(i.fieldname)&&(i.hidden=!0),["custom_purchase_bill_number","custom_vat_amount","custom_expense_amount"].includes(i.fieldname)&&(i.hidden=e.value.custom_bill_type!=="Company Name"),["custom_invoice_number"].includes(i.fieldname)&&(i.hidden=e.value.custom_bill_type!=="Other Name"),i))}});C(()=>e.value.custom_bill_type,()=>{w.reload()}),C(()=>[e.value.custom_expense_amount,e.value.custom_vat_amount,e.value.custom_bill_type],()=>{if(e.value.custom_bill_type==="Company Name"){const c=parseFloat(e.value.custom_expense_amount||0),t=parseFloat(e.value.custom_vat_amount||0);e.value.amount=c+t}}),w.reload();const A=T(()=>l.isReadOnly?r("Expense Item"):d.value===null?r("New Expense Item"):r("Edit Expense Item")),H=T(()=>{var c;return(c=w.data)==null?void 0:c.some(t=>{if(t.reqd&&!e.value[t.fieldname])return!0})});return C(()=>e.value.expense_type,c=>{var t;e.value.description||(e.value.description=(t=Y[c])==null?void 0:t.description),e.value.cost_center=l.expenseClaim.cost_center}),C(()=>e.value.amount,c=>{x.value?x.value=!1:e.value.sanctioned_amount=parseFloat(c)}),(c,t)=>{const i=P("Button");return p(),_($,null,[n("div",Z,[n("h2",ee,f(o(r)("Expenses")),1),n("div",te,[n("span",se,f(o(B)(a.expenseClaim.total_claimed_amount,a.currency)),1),a.isReadOnly?E("",!0):(p(),j(i,{key:0,id:"add-expense-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:t[0]||(t[0]=s=>D())}))])]),a.expenseClaim.expenses?(p(),_("div",ae,[(p(!0),_($,null,M(a.expenseClaim.expenses,(s,g)=>(p(),_("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:g,onClick:he=>D(s,g)},[n("div",le,[n("div",oe,[n("div",ie,[n("div",ue,[n("div",re,f(o(r)(s.expense_type)),1),n("div",ce,[n("span",null,f(o(r)("{0}: {1}",[o(r)("Sanctioned"),o(B)(s.sanctioned_amount||0,a.currency)])),1),t[4]||(t[4]=n("span",{class:"whitespace-pre"}," Â· ",-1)),s.expense_date?(p(),_("span",de,f(o(h)(s.expense_date).format("D MMM")),1)):E("",!0)])])]),n("div",me,[n("span",pe,f(o(B)(s.amount,a.currency)),1),y(o(N),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,ne))),128))])):(p(),j(W,{key:1,message:o(r)("No expenses added"),isTableField:!0},null,8,["message"])),y(X,{isOpen:m.value,onDidDismiss:t[3]||(t[3]=s=>O())},{actionSheet:b(()=>[n("div",fe,[n("div",xe,[n("span",_e,f(A.value),1)]),n("div",ve,[n("div",ye,[(p(!0),_($,null,M(o(w).data,s=>(p(),j(Q,{key:s.fieldname,class:"w-full",label:o(r)(s.label,null,"Expense Claim Detail"),fieldtype:s.fieldtype,fieldname:s.fieldname,options:s.options,hidden:s.hidden,reqd:s.reqd,default:s.default,readOnly:s.read_only||a.isReadOnly,modelValue:e.value[s.fieldname],"onUpdate:modelValue":g=>e.value[s.fieldname]=g},null,8,["label","fieldtype","fieldname","options","hidden","reqd","default","readOnly","modelValue","onUpdate:modelValue"]))),128))]),a.isReadOnly?E("",!0):(p(),_("div",be,[d.value!==null?(p(),j(i,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:t[1]||(t[1]=s=>U())},{prefix:b(()=>[y(o(N),{name:"trash",class:"w-4"})]),default:b(()=>[S(" "+f(o(r)("Delete")),1)]),_:1})):E("",!0),y(i,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:t[2]||(t[2]=s=>z()),disabled:H.value},{prefix:b(()=>[y(o(N),{name:d.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[S(" "+f(d.value===null?o(r)("Add Expense"):o(r)("Update Expense")),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)}}};export{Ne as default};
//# sourceMappingURL=ExpensesTable-fEHtWQej.js.map
